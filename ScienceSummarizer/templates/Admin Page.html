<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Articles & User Management with User Info</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      position: relative;
      min-height: 100vh;
      background-color: #f3fbff;
    }
  
    
    .background-img {
      width: 50%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
    }
    main {
      position: relative;
      z-index: 10;
      max-width: 48rem; /* max-w-4xl */
      margin-left: auto;
      margin-right: auto;
      background-color: #f3fbff;
      border-radius: 0.375rem; /* rounded-md */
      padding: 1.5rem; /* p-6 */
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    }
    /* Scroll for table on small screens */
    .table-container {
      overflow-x: auto;
    }
    /* Logo container */
    .logo-container {
      position: absolute;
      top: 2rem; /* 8 */
      left: 2rem; /* 8 */
      z-index: 20;
    }
    /* Section spacing */
    section + section {
      margin-top: 3rem;
    }
  </style>
</head>
<body>
  <div class="background-container" aria-hidden="true">
    <img src="C:\Users\btool\Downloads\img_group_29.png" alt="Background" class="background-img" />
    <div class="logo-container">
      <img src="public/images/img_logo_s.png" alt="Logo S" class="section__content__column__header__logo" />
    </div>
  </div>

  <main>
    <!-- User Info Section -->
    <section aria-label="Signed in user information" class="mb-8 p-4 bg-[#e8f2fb] rounded-md">
      <h2 class="text-[#0f2e53] font-extrabold text-[20px] mb-2">Signed In User Info</h2>
      <p class="text-[#0f2e53] text-[16px]"><strong>User ID:</strong> <span id="user-id">Loading...</span></p>
      <p class="text-[#0f2e53] text-[16px]"><strong>Email:</strong> <span id="user-email">Loading...</span></p>
    </section>

    <!-- Articles Dashboard Section -->
    <section aria-label="Articles dashboard">
      <div class="grid grid-cols-1 sm:grid-cols-4 gap-6 mb-8" aria-label="Summary statistics">
        <div class="bg-[#e8f2fb] rounded-md py-6 px-4 text-center" id="uploaded-articles-card" role="region" aria-live="polite" aria-atomic="true">
          <p class="text-[28px] font-extrabold text-[#0f2e53] leading-none" id="uploaded-articles-count">0</p>
          <p class="text-[16px] font-normal text-[#0f2e53] mt-1">Uploaded Articles</p>
        </div>
        <div class="bg-[#e8f2fb] rounded-md py-6 px-4 text-center" id="users-card" role="region" aria-live="polite" aria-atomic="true">
          <p class="text-[28px] font-extrabold text-[#0f2e53] leading-none" id="users-count">1</p>
          <p class="text-[16px] font-normal text-[#0f2e53] mt-1">Users</p>
        </div>
        <div class="bg-[#e8f2fb] rounded-md py-6 px-4 text-center" id="extraction-success-card" role="region" aria-live="polite" aria-atomic="true">
          <p class="text-[28px] font-extrabold text-[#0f2e53] leading-none" id="extraction-success-percent">0%</p>
          <p class="text-[16px] font-normal text-[#0f2e53] mt-1">Extraction Success</p>
        </div>
        <div class="bg-[#e8f2fb] rounded-md py-6 px-4 text-center flex flex-col items-center justify-center" id="recent-activity-card" role="region" aria-live="polite" aria-atomic="true">
          <svg class="w-10 h-6 text-[#0f2e53]" fill="none" stroke="#0f2e53" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M2 12c3 0 3-6 6-6s3 6 6 6 3-6 6-6 3 6 6 6"></path>
          </svg>
          <p class="text-[16px] font-normal text-[#0f2e53] mt-1" id="recent-activity-text">No recent activity</p>
        </div>
      </div>

      <div class="flex justify-between items-center mb-4">
        <h2 class="text-[#0f2e53] font-extrabold text-[20px]">Extracted Articles</h2>
        <label for="file-upload" class="bg-[#2a5ea8] text-white font-extrabold text-[16px] px-5 py-2 rounded-md cursor-pointer select-none" tabindex="0" role="button" aria-pressed="false">
          Upload
        </label>
        <input id="file-upload" type="file" multiple accept=".txt,.md,.docx,.pdf" class="hidden" />
      </div>

      <div class="table-container">
        <table class="w-full text-[#0f2e53] border-collapse rounded-md overflow-hidden" aria-describedby="table-description">
          <caption id="table-description" class="sr-only">List of extracted articles with title, date, status, and action buttons</caption>
          <thead class="bg-[#e8f2fb] text-[16px] font-extrabold">
            <tr>
              <th scope="col" class="text-left py-3 px-4">Title</th>
              <th scope="col" class="text-left py-3 px-4">Date</th>
              <th scope="col" class="text-left py-3 px-4">Status</th>
              <th scope="col" class="text-left py-3 px-4">Action</th>
            </tr>
          </thead>
          <tbody id="articles-table-body" class="bg-white divide-y divide-[#e8f2fb]">
            <!-- Rows will be dynamically added here -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- User Management Section -->
    <section aria-label="User management">
      <h2 class="text-[#0f2e53] font-extrabold text-[20px] mb-4">User Management</h2>

      <form id="add-user-form" class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6" aria-label="Add new user">
        <input
          type="text"
          id="new-username"
          placeholder="Username"
          required
          class="px-3 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#2a5ea8] text-[#0f2e53] flex-grow"
          aria-label="New username"
        />
        <input
          type="email"
          id="new-email"
          placeholder="Email"
          required
          class="px-3 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#2a5ea8] text-[#0f2e53] flex-grow"
          aria-label="New user email"
        />
        <button
          type="submit"
          class="bg-[#2a5ea8] text-white font-extrabold px-5 py-2 rounded-md hover:bg-[#1f4a7a] focus:outline-none focus:ring-2 focus:ring-[#1f4a7a]"
          aria-label="Add user"
        >
          Add User
        </button>
      </form>

      <div class="table-container" role="region" aria-live="polite" aria-label="User list">
        <table class="w-full text-[#0f2e53] border-collapse rounded-md overflow-hidden" aria-describedby="user-table-desc">
          <caption id="user-table-desc" class="sr-only">List of users with options to edit or delete</caption>
          <thead class="bg-[#e8f2fb] text-[16px] font-extrabold">
            <tr>
              <th scope="col" class="text-left py-3 px-4">Username</th>
              <th scope="col" class="text-left py-3 px-4">Email</th>
              <th scope="col" class="text-left py-3 px-4">Actions</th>
            </tr>
          </thead>
          <tbody id="users-table-body" class="bg-white divide-y divide-[#e8f2fb]">
            <!-- User rows dynamically added here -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // Allowed email for sign-in to this page
    const allowedEmail = 'admin123@outlook.com';

    // Simulated signed-in user info (replace with real auth integration)
    // For demo, we simulate getting user info from localStorage or sessionStorage or a global auth object
    // Here we simulate with a hardcoded example, but check email against allowedEmail
    const signedInUser = {
      id: 'admin',
      Password: 'admin123'
    };

    // Check if signed-in user email is allowed
    if (signedInUser.email.toLowerCase() !== allowedEmail.toLowerCase()) {
      alert('Access denied. You are not authorized to view this page.');
      // Redirect to sign-in page or homepage
      window.location.href = 'LoginOne.html'; // Change to your sign-in page URL
    }

    // Articles data (all articles uploaded by all users)
    const articles = [];

    // Users data
    const users = [
      { id: 1, username: 'admin', email: 'admin123@outlook.com' },
      { id: 2, username: 'user1', email: 'user1@example.com' },
      { id: 3, username: 'user2', email: 'user2@example.com' }
    ];

    // DOM elements for user info
    const userIdEl = document.getElementById('user-id');
    const userEmailEl = document.getElementById('user-email');

    // DOM elements for articles
    const uploadedArticlesCountEl = document.getElementById('uploaded-articles-count');
    const usersCountEl = document.getElementById('users-count');
    const extractionSuccessPercentEl = document.getElementById('extraction-success-percent');
    const recentActivityTextEl = document.getElementById('recent-activity-text');
    const articlesTableBody = document.getElementById('articles-table-body');
    const fileUploadInput = document.getElementById('file-upload');

    // DOM elements for users
    const usersTableBody = document.getElementById('users-table-body');
    const addUserForm = document.getElementById('add-user-form');
    const newUsernameInput = document.getElementById('new-username');
    const newEmailInput = document.getElementById('new-email');

    // Show signed-in user info
    function displaySignedInUser() {
      userIdEl.textContent = signedInUser.id;
      userEmailEl.textContent = signedInUser.email;
    }

    // Initialize users count in articles dashboard
    function updateUsersCount() {
      usersCountEl.textContent = users.length;
    }

    // Utility: format date as YYYY-MM-DD
    function formatDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    // Update articles dashboard stats
    function updateArticleStats() {
      // Filter articles uploaded by signed-in user only
      const userArticles = articles.filter(a => a.userId === signedInUser.id);

      uploadedArticlesCountEl.textContent = userArticles.length;

      // Extraction success: percentage of articles with status 'Extracted'
      const extractedCount = userArticles.filter(a => a.status === 'Extracted').length;
      const successPercent = userArticles.length === 0 ? 0 : Math.round((extractedCount / userArticles.length) * 100);
      extractionSuccessPercentEl.textContent = successPercent + '%';

      // Recent activity: show last upload date or no recent activity
      if (userArticles.length > 0) {
        const lastDate = userArticles.reduce((latest, a) => a.date > latest ? a.date : latest, new Date(0));
        recentActivityTextEl.textContent = `Last upload: ${formatDate(lastDate)}`;
      } else {
        recentActivityTextEl.textContent = 'No recent activity';
      }
    }

    // Render articles table rows (only user's articles)
    function renderArticles() {
      articlesTableBody.innerHTML = '';
      const userArticles = articles.filter(a => a.userId === signedInUser.id);
      userArticles.forEach((article, index) => {
        const tr = document.createElement('tr');

        // Title cell with editable input
        const titleTd = document.createElement('td');
        titleTd.className = 'py-4 px-4';
        const titleInput = document.createElement('input');
        titleInput.type = 'text';
        titleInput.value = article.title;
        titleInput.className = 'w-full border border-gray-300 rounded px-2 py-1 text-[#0f2e53] text-[16px] font-normal';
        titleInput.setAttribute('aria-label', `Edit title for article ${index + 1}`);
        titleInput.addEventListener('change', (e) => {
          article.title = e.target.value;
        });
        titleTd.appendChild(titleInput);
        tr.appendChild(titleTd);

        // Date cell (not editable)
        const dateTd = document.createElement('td');
        dateTd.className = 'py-4 px-4 text-[16px] font-normal';
        dateTd.textContent = formatDate(article.date);
        tr.appendChild(dateTd);

        // Status cell with select dropdown
        const statusTd = document.createElement('td');
        statusTd.className = 'py-4 px-4';
        const statusSelect = document.createElement('select');
        statusSelect.className = 'bg-[#e8f2fb] text-[#0f2e53] font-semibold text-[14px] px-3 py-1 rounded-md';
        statusSelect.setAttribute('aria-label', `Change status for article ${index + 1}`);
        ['Extracted', 'Pending', 'Failed'].forEach(statusOption => {
          const option = document.createElement('option');
          option.value = statusOption;
          option.textContent = statusOption;
          if (article.status === statusOption) option.selected = true;
          statusSelect.appendChild(option);
        });
        statusSelect.addEventListener('change', (e) => {
          article.status = e.target.value;
          updateArticleStats();
        });
        statusTd.appendChild(statusSelect);
        tr.appendChild(statusTd);

        // Action cell with View button
        const actionTd = document.createElement('td');
        actionTd.className = 'py-4 px-4';
        const viewBtn = document.createElement('button');
        viewBtn.className = 'bg-[#e8f2fb] text-[#0f2e53] font-semibold text-[16px] px-4 py-1 rounded-md hover:bg-[#d0e2f7] focus:outline-none focus:ring-2 focus:ring-[#2a5ea8]';
        viewBtn.textContent = 'View';
        viewBtn.setAttribute('aria-label', `View article ${index + 1}`);
        viewBtn.addEventListener('click', () => {
          alert(`Viewing article:\n\nTitle: ${article.title}\nDate: ${formatDate(article.date)}\nStatus: ${article.status}`);
        });
        actionTd.appendChild(viewBtn);
        tr.appendChild(actionTd);

        articlesTableBody.appendChild(tr);
      });
    }

    // Handle file uploads for articles (assign to signed-in user)
    fileUploadInput.addEventListener('change', (event) => {
      const files = Array.from(event.target.files);
      if (files.length === 0) return;

      files.forEach(file => {
        // Simulate extraction by using file name as title and mark status as Extracted
        const newArticle = {
          title: file.name,
          date: new Date(),
          status: 'Extracted',
          userId: signedInUser.id
        };
        articles.push(newArticle);
      });

      renderArticles();
      updateArticleStats();

      // Clear input so same files can be uploaded again if needed
      fileUploadInput.value = '';
    });

    // Validate email format
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Render users table rows
    function renderUsers() {
      usersTableBody.innerHTML = '';
      users.forEach(user => {
        const tr = document.createElement('tr');

        // Username cell with editable input
        const usernameTd = document.createElement('td');
        usernameTd.className = 'py-4 px-4';
        const usernameInput = document.createElement('input');
        usernameInput.type = 'text';
        usernameInput.value = user.username;
        usernameInput.className = 'w-full border border-gray-300 rounded px-2 py-1 text-[#0f2e53] text-[16px] font-normal';
        usernameInput.setAttribute('aria-label', `Edit username for user ${user.id}`);
        usernameInput.addEventListener('change', (e) => {
          const val = e.target.value.trim();
          if (val) {
            user.username = val;
          } else {
            alert('Username cannot be empty.');
            e.target.value = user.username;
          }
          renderUsers();
          updateUsersCount();
        });
        usernameTd.appendChild(usernameInput);
        tr.appendChild(usernameTd);

        // Email cell with editable input
        const emailTd = document.createElement('td');
        emailTd.className = 'py-4 px-4';
        const emailInput = document.createElement('input');
        emailInput.type = 'email';
        emailInput.value = user.email;
        emailInput.className = 'w-full border border-gray-300 rounded px-2 py-1 text-[#0f2e53] text-[16px] font-normal';
        emailInput.setAttribute('aria-label', `Edit email for user ${user.id}`);
        emailInput.addEventListener('change', (e) => {
          const val = e.target.value.trim();
          if (val && validateEmail(val)) {
            user.email = val;
          } else {
            alert('Please enter a valid email address.');
            e.target.value = user.email;
          }
          renderUsers();
        });
        emailTd.appendChild(emailInput);
        tr.appendChild(emailTd);

        // Actions cell with Delete button
        const actionsTd = document.createElement('td');
        actionsTd.className = 'py-4 px-4';
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'bg-red-500 text-white font-semibold text-[16px] px-4 py-1 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-700';
        deleteBtn.textContent = 'Delete';
        deleteBtn.setAttribute('aria-label', `Delete user ${user.username}`);
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Are you sure you want to delete user "${user.username}"?`)) {
            const index = users.findIndex(u => u.id === user.id);
            if (index !== -1) {
              users.splice(index, 1);
              renderUsers();
              updateUsersCount();
            }
          }
        });
        actionsTd.appendChild(deleteBtn);
        tr.appendChild(actionsTd);

        usersTableBody.appendChild(tr);
      });
    }

    // Handle add user form submission
    addUserForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = newUsernameInput.value.trim();
      const email = newEmailInput.value.trim();

      if (!username) {
        alert('Username is required.');
        return;
      }
      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
      }

      // Check for duplicate username or email
      if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
        alert('Username already exists.');
        return;
      }
      if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
        alert('Email already exists.');
        return;
      }

      // Add new user with unique id
      const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
      users.push({ id: newId, username, email });

      // Clear inputs
      newUsernameInput.value = '';
      newEmailInput.value = '';

      renderUsers();
      updateUsersCount();
    });

    // Initial render
    displaySignedInUser();
    renderArticles();
    updateArticleStats();
    renderUsers();
    updateUsersCount();
  </script>
</body>
</html>